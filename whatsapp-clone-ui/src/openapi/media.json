{
  "openapi": "3.1.0",
  "info": {
    "title": "API Documentation"
  },
  "servers": [
    {
      "url": "http://localhost:8080/media",
      "description": "Media API via Gateway"
    }
  ],
  "security": [
    {
      "keycloak": []
    }
  ],
  "tags": [
    {
      "name": "Media Controller",
      "description": "CRUD Rest APIs for managing media files"
    }
  ],
  "paths": {
    "/api/v1/media": {
      "post": {
        "tags": [
          "Media Controller"
        ],
        "summary": "Upload media file",
        "operationId": "uploadMedia",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "files": {
                    "type": "array",
                    "description": "The media files",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    }
                  },
                  "filePath": {
                    "type": "string",
                    "description": "The media file path",
                    "example": "550e8400-e29b-41d4-a716-446655440000",
                    "minLength": 1
                  },
                  "entityId": {
                    "type": "string",
                    "description": "The entity Id related to the media",
                    "example": "USR_550e8400-e29b-41d4-a716-446655440000",
                    "minLength": 1
                  }
                },
                "required": [
                  "entityId",
                  "filePath",
                  "files"
                ]
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Media file uploaded successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "headers": {
                      "type": "object",
                      "properties": {
                        "requestId": {
                          "description": "Unique request identifier",
                          "example": "string"
                        },
                        "statusCode": {
                          "description": "Status code of the response",
                          "example": "string"
                        }
                      }
                    },
                    "body": {
                      "$ref": "#/components/schemas/MediaReferenceListResponse"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Media file creation failed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "headers": {
                      "type": "object",
                      "properties": {
                        "requestId": {
                          "description": "Unique request identifier",
                          "example": "string"
                        },
                        "statusCode": {
                          "description": "Status code of the response",
                          "example": "string"
                        }
                      }
                    },
                    "body": {
                      "$ref": "#/components/schemas/ErrorBody"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/media/{reference}": {
      "get": {
        "tags": [
          "Media Controller"
        ],
        "summary": "View media file",
        "operationId": "getMediaView",
        "parameters": [
          {
            "name": "reference",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Media file viewed successfully",
            "content": {
              "*/*": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "404": {
            "description": "Media file not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "headers": {
                      "type": "object",
                      "properties": {
                        "requestId": {
                          "description": "Unique request identifier",
                          "example": "string"
                        },
                        "statusCode": {
                          "description": "Status code of the response",
                          "example": "string"
                        }
                      }
                    },
                    "body": {
                      "$ref": "#/components/schemas/ErrorBody"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Media Controller"
        ],
        "summary": "Delete media file",
        "operationId": "deleteMedia",
        "parameters": [
          {
            "name": "reference",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Media file deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "headers": {
                      "type": "object",
                      "properties": {
                        "requestId": {
                          "description": "Unique request identifier",
                          "example": "string"
                        },
                        "statusCode": {
                          "description": "Status code of the response",
                          "example": "string"
                        }
                      }
                    },
                    "body": {
                      "$ref": "#/components/schemas/BooleanResponse"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/media/list/{entityId}": {
      "get": {
        "tags": [
          "Media Controller"
        ],
        "summary": "Retrieve entity related media references",
        "operationId": "getMediaListReferences",
        "parameters": [
          {
            "name": "entityId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Entity media references retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "headers": {
                      "type": "object",
                      "properties": {
                        "requestId": {
                          "description": "Unique request identifier",
                          "example": "string"
                        },
                        "statusCode": {
                          "description": "Status code of the response",
                          "example": "string"
                        }
                      }
                    },
                    "body": {
                      "$ref": "#/components/schemas/MediaReferenceListResponse"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Entity media files not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "headers": {
                      "type": "object",
                      "properties": {
                        "requestId": {
                          "description": "Unique request identifier",
                          "example": "string"
                        },
                        "statusCode": {
                          "description": "Status code of the response",
                          "example": "string"
                        }
                      }
                    },
                    "body": {
                      "$ref": "#/components/schemas/ErrorBody"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "MediaReferenceListResponse": {
        "type": "object",
        "description": "Schema to hold the media list response",
        "properties": {
          "mediaReferencesList": {
            "type": "array",
            "description": "The entity media list references",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ErrorBody": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "details": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "BooleanResponse": {
        "type": "object",
        "description": "Schema to hold the boolean response",
        "properties": {
          "done": {
            "type": "boolean"
          }
        }
      }
    },
    "securitySchemes": {
      "keycloak": {
        "type": "oauth2",
        "in": "header",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "flows": {
          "password": {
            "authorizationUrl": "http://localhost:9090/realms/whatsapp-clone/protocol/openid-connect/auth",
            "tokenUrl": "http://localhost:9090/realms/whatsapp-clone/protocol/openid-connect/token",
            "scopes": {}
          }
        }
      }
    }
  }
}
