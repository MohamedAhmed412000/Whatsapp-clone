@if (chat() != null) {
  <div class="wac-navbar d-flex flex-row justify-content-between w-100 px-4"
    (click)="openProfile($event)"
  >
    <div class="d-flex align-items-center">
      <div class="avatar">
        @if (chat()?.chatImageReference != null) {
          <img [src]="chat()?.chatImageReference! | mediaUrl:true | async" alt="chat-avatar"
               class="avatar-unknown" width="60px" height="60px" style="object-fit: cover">
        } @else {
          @if (chat()?.isGroupChat) {
            <fa-icon icon="user-group" class="avatar-unknown"></fa-icon>
          } @else {
            <fa-icon icon="user" class="avatar-unknown"></fa-icon>
          }
        }
      </div>
      <div class="d-flex flex-column">
        <div class="ms-3 text-truncate fs-4">
          {{ chat()?.name }} @if (isSelfChat()) {(You)}
        </div>
        <div class="subtitle text-truncate ms-3 fs-6">
          @if (chat()?.isGroupChat) {
            {{ chatUsersString }}
          } @else {
            <div class="d-flex gap-1 align-items-center">
              @if (isSelfChat()) {
                <small class="subtitle fs-6">Message yourself</small>
              } @else {
                @if (chat()?.isRecipientOnline) {
                  <small class="online-status"></small>
                  <small class="fs-6">Online</small>
                } @else {
                  <small class="offline-status"></small>
                  <small class="fs-6">Offline</small>
                }
              }
            </div>
          }
        </div>
      </div>
    </div>

    <div class="d-flex align-items-center" (click)="stopMainEffect($event)">
      @if (!isSelfChat()) {
        <div class="btn-group me-2" role="group" aria-label="Second group">
          <button type="button" class="btn btn-secondary rounded-start-1 px-3">
            <fa-icon icon="video" class="fs-3"></fa-icon>
          </button>
          <button type="button" class="btn btn-secondary rounded-end-1 px-3">
            <fa-icon icon="phone" class="fs-3"></fa-icon>
          </button>
        </div>
      }

      <button type="button" class="btn btn-transparent rounded-1 px-3">
        <fa-icon icon="search" class="fs-3"></fa-icon>
      </button>
    </div>
  </div>

  @if (showProfile) {
    <div class="profile-sidebar" (click)="stopMainEffect($event)">
      <div class="profile-container d-flex h-100">

        <div class="profile-menu p-1 rounded-1">
          <ul class="list-unstyled m-0">
            @for (item of profileTabs; track item.id) {
              @if (item.id !== 'members' || this.chat()?.isGroupChat) {
                <li
                  [class.active]="selectedTab === item.id"
                  (click)="selectTab(item.id)">
                  <fa-icon [icon]="item.icon" class="me-3"></fa-icon>
                  {{ item.label }}
                </li>
              }
            }
          </ul>
        </div>

        <div class="flex-grow-1">
          <div class="profile-content p-4 pb-1">
            @if (selectedTab === 'overview' && !this.chat().isGroupChat) {
              <button class="edit-profile btn btn-transparent rounded-1 py-2 px-3"
                (click)="openEditContactModal()"
              >
                <fa-icon icon="pen" class="fs-5"></fa-icon>
              </button>
            }

            @switch (selectedTab) {
              @case ('overview') {
                <div class="d-flex flex-column align-items-center">
                  @if (chat()?.chatImageReference != null) {
                    <img
                      [src]="chat()?.chatImageReference | mediaUrl:true | async"
                      alt="profile-photo"
                      class="profile-photo mb-3"
                    />
                  } @else {
                    @if (chat()?.isGroupChat) {
                      <fa-icon icon="user-group" class="profile-photo avatar-unknown mb-3"></fa-icon>
                    } @else {
                      <fa-icon icon="user" class="profile-photo avatar-unknown mb-3"></fa-icon>
                    }
                  }
                  <h3 class="fw-bold">{{ chat()?.name }}</h3>
                  @if (!chat()?.isGroupChat) {
                    <h5 class="subtitle">
                      @if (isSelfChat()) {
                        ~{{ chat()?.name }}
                      } @else {
                        ~{{ singleChatUser.fullname }}
                      }
                    </h5>
                  }
                </div>

                @if (!isSelfChat()) {
                  <div class="d-flex flex-row justify-content-center py-3">
                    <button type="button" class="btn btn-secondary rounded-1 mx-1 w-50">
                      <fa-icon icon="video" class="fs-3"></fa-icon><br>
                      <span class="fw-light">Video</span>
                    </button>
                    <button type="button" class="btn btn-secondary rounded-1 mx-1 w-50">
                      <fa-icon icon="phone" class="fs-3"></fa-icon><br>
                      <span class="fw-light">Voice</span>
                    </button>
                  </div>
                }

                <div class="mt-3 text-start">
                  <h6 class="subtitle mb-1">
                    @if (chat()?.isGroupChat) {
                      Description
                    } @else {
                      About
                    }
                  </h6>
                  <p>
                    @if (chat()?.isGroupChat) {
                      {{ chat()?.description || 'No status set' }}
                    } @else {
                      @if (isSelfChat()) {
                        {{ me.description || 'No status set' }}
                      } @else {
                        {{ singleChatUser.description || 'No status set' }}
                      }
                    }
                  </p>

                  @if (!chat()?.isGroupChat) {
                    <h6 class="subtitle mb-1 mt-3">Email</h6>
                    @if (isSelfChat()) {
                      <p>{{ me.email }}</p>
                    } @else {
                      <p>{{ singleChatUser.email }}</p>
                    }
                  }

                  <h6 class="subtitle mt-3">Disappearing messages</h6>
                  <p>Off</p>

                  @if (!isSelfChat()) {
                    <hr/>

                    <button class="btn btn-md btn-secondary rounded-1 ms-1 py-1 px-3 fw-light">Add to favourites</button>
                    <div class="d-flex flex-row justify-content-center py-3">
                      <button type="button" class="btn btn-md btn-secondary rounded-1 mx-1 py-1 px-3 w-50 fw-light">
                        Block
                      </button>
                      <button type="button"
                              class="btn btn-md btn-secondary color-red rounded-1 mx-1 py-1 px-3 w-50 fw-light">
                        Report contact
                      </button>
                    </div>
                  }
                </div>
              }

              @case ('members') {
                <div class="members-list d-flex flex-column p-0">
                  @if (this.isAddingChatMembers) {
                    <h5 class="text-white mb-3 fs-3">
                      <button class="btn m-0 p-0" (click)="returnToMembersView()">
                        <fa-icon icon="arrow-left"></fa-icon>
                      </button>
                      &nbsp;&nbsp;Add members
                    </h5>
                  } @else {
                    <h5 class="text-white mb-3 fs-3">
                      Members ({{ this.chatUsers().length }})
                    </h5>
                  }

                  <div class="input-group search-input pb-3">
                    @if (!isAddingChatMembers) {
                      <span class="input-group-text">
                        <fa-icon [icon]="'search'"></fa-icon>
                      </span>
                    }
                    <input
                      type="text"
                      class="form-control form-control-md fs-6 search-box"
                      [placeholder]="isAddingChatMembers? 'Search': 'Search members'"
                      aria-label="Search"
                    />
                  </div>

                  @if (isAddingChatMembers) {

                  } @else {
                    <div class="add-member-item d-flex align-items-center mb-2 py-2 px-2 rounded hover-bg"
                         (click)="addChatMember()">
                      <div class="user-avatar rounded-circle bg-secondary d-flex align-items-center justify-content-center me-3">
                        <fa-icon icon="user-plus" class="text-white fs-4"></fa-icon>
                      </div>
                      <span class="text-white">Add members</span>
                    </div>

                    <div class="members-container flex-grow-1 overflow-auto">
                      <div class="member-item d-flex align-items-center justify-content-between py-2 px-2 rounded hover-bg">
                        <div class="d-flex align-items-center">
                          @if (me.imageFileReference) {
                            <img [src]="me.imageFileReference | mediaUrl:true | async"
                                 alt="Profile" class="user-avatar rounded-circle me-3">
                          } @else {
                            <div class="user-avatar rounded-circle bg-secondary me-3 d-flex align-items-center justify-content-center">
                              <fa-icon icon="user" class="text-light fs-4"></fa-icon>
                            </div>
                          }

                          <div class="text-light">
                            <div class="fw-semibold">You</div>
                            <small class="text-muted d-block">{{ me.email }}</small>
                          </div>
                        </div>

                        @if (me.admin) {
                          <span class="text-success small fw-medium">Admin</span>
                        }
                      </div>
                      @for (chatUser of this.chatUsers(); track chatUser.id) {
                        @if (!isSelfChatUser(chatUser.id!)) {
                          <div class="member-item d-flex align-items-center justify-content-between py-2 px-2 rounded hover-bg">
                            <div class="d-flex align-items-center">
                              @if (chatUser.imageFileReference) {
                                <img [src]="chatUser.imageFileReference | mediaUrl:true | async"
                                     alt="Profile" class="user-avatar rounded-circle me-3">
                              } @else {
                                <div class="user-avatar rounded-circle bg-secondary me-3 d-flex align-items-center justify-content-center">
                                  <fa-icon icon="user" class="text-light fs-4"></fa-icon>
                                </div>
                              }

                              <div class="text-light">
                                <div class="fw-semibold">
                                  {{ chatUser.firstname + ' ' + chatUser.lastname }}
                                </div>
                                <small class="text-muted d-block">{{ chatUser.email }}</small>
                              </div>
                            </div>

                            @if (chatUser.admin) {
                              <span class="text-success small fw-medium">Admin</span>
                            }
                          </div>
                        }
                      }
                    </div>
                  }
                </div>
              }

              @case ('media') {
                <p>Media files shown here...</p>
              }

              @case ('files') {
                <p>Uploaded documents shown here...</p>
              }

              @case ('links') {
                <p>Shared links shown here...</p>
              }

              @case ('events') {
                <p>Upcoming events shown here...</p>
              }

              @case ('encryption') {
                <p>Your messages are end-to-end encrypted.</p>
              }
            }

          </div>
        </div>

      </div>
    </div>
  }
}
